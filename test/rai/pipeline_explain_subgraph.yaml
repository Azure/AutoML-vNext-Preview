name: AML_Explain_Subgraph_VERSION_REPLACEMENT_STRING
experiment_name: AML_Explain_Subgraph_Experiment_VERSION_REPLACEMENT_STRING
type: pipeline

inputs:
  model_analysis:
    dataset: azureml:Model_Analysis_Info:VERSION_REPLACEMENT_STRING
    mode: ro_mount

outputs:
  explainer_directory:
    data:
      datastore: azureml:workspaceblobstore
  explanation_dir:
    data:
      datastore: azureml:workspaceblobstore
  model_dir:
    data:
      datastore: azureml:workspaceblobstore
  train_data:
    data:
      datastore: azureml:workspaceblobstore
  test_data:
    data:
      datastore: azureml:workspaceblobstore



compute: azureml:cpucluster

settings:
  component_job:
    datastore: azureml:workspaceblobstore
    environment: azureml:AML-RAI-Environment:VERSION_REPLACEMENT_STRING

jobs:
  extract-ma-data-job:
    type: component_job
    component: azureml:AzureMLModelAnalysisExtractData:VERSION_REPLACEMENT_STRING
    inputs:
      model_analysis: ${{inputs.model_analysis}}
    outputs:
      model: ${{outputs.model_dir}}
      train_data: ${{outputs.train_data}}
      test_data: ${{outputs.test_data}}

  create-explainer-job:
    type: component_job
    component: azureml:AzureMLModelAnalysisCustomExplainer:VERSION_REPLACEMENT_STRING
    inputs:
      model: ${{jobs.extract-ma-data-job.outputs.model}}
      train_data: ${{jobs.extract-ma-data-job.outputs.train_data}}
    outputs:
      explainer: ${{outputs.explainer_directory}}

  create-explanation-job:
    type: component_job
    component: azureml:AzureMLModelAnalysisGenerateExplanation:VERSION_REPLACEMENT_STRING
    inputs:
      model_analysis_info: ${{inputs.model_analysis}}
      explainer: ${{jobs.create-explainer-job.outputs.explainer}}
    outputs:
      model_analysis_explanation: ${{outputs.explanation_dir}}



